(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";let e={timeout:1500,retry:0};const r=new Map;function n(e,n,t){return new Promise(function(o,s){const a=function(e){if(!r.has(e))throw new Error(`未找到${e}类型的加载器，请先注册自定义加载器`);return r.get(e)}(n),c=setTimeout(()=>{s(new Error(`Resource ${e} load timeout (${t}ms)`))},t);a(e).then(function(r){clearTimeout(c),o({url:e,success:!0,data:r,error:null})}).catch(function(r){clearTimeout(c),s({url:e,success:!1,data:null,error:r})})})}async function t(e,r,o,s){if(s.has(e))return s.get(e);const a=r.find(r=>r.name===e);if(!a)throw new Error(`未找到name为${e}的资源配置`);const c=a.dependencies||[];for(const e of c)await t(e,r,o,s);const{urls:i,type:u}=a;let l=null,f="success",d=null;try{l=await async function(e,r,t,o){if(!Array.isArray(r)||0===r.length)throw new Error("urls必须是非空数组");const s=[];for(const a of r)try{const r=await n(a,t,o);return s.length&&console.warn(`加载${e}资源时的一些错误信息：`,s),r}catch(e){s.push({url:a,error:e})}throw console.warn(`所有${e}资源加载错误信息`,s),new Error(`所有${e}资源加载失败，错误内容看上面`)}(e,i,u,o)}catch(e){f="failed",d=e}const w={name:e,config:a,result:l,status:f,error:d};return s.set(e,w),w}async function o(r){if(!Array.isArray(r)||0===r.length)throw new Error("配置数组必须是非空数组");const n=r.map(function(e){if("string"==typeof e){const r=new URL(e,window.location.href);return{name:r.pathname,urls:[e],type:r.pathname.split(".").pop()||"js"}}if(Array.isArray(e)){if(!e.length)return;const r=new URL(e[0],window.location.href);return{name:r.pathname,urls:e,type:r.pathname.split(".").pop()||"js"}}return"string"==typeof e.urls&&(e.urls=[e.urls]),e}).filter(Boolean),{timeout:o}={...e};!function(e){const r=new Map(e.map(e=>[e.name,e])),n=new Set,t=new Set;for(const t of e)n.has(t.name)||o(r,t.name);function o(e,r){const s=e.get(r);if(!s)throw new Error(`未找到ID为${r}的资源配置`);if(t.has(r))throw new Error(`检测到循环依赖：${Array.from(t).join(" -> ")} -> ${r}`);if(n.has(r))return;t.add(r);const a=s.dependencies||[];for(const r of a)o(e,r);t.delete(r),n.add(r)}}(n);const s=new Map,a=n.map(async function(e){return await t(e.name,n,o,s)});return Promise.all(a).then(function(e){return e.find(e=>e.error)?Promise.reject(e):e})}r.set("js",function(e){const r=document.createElement("script");return new Promise(function(n,t){r.type="text/javascript",r.src=e,r.async=!1,r.dataset.flag="resource-preloader",r.addEventListener("load",function(e){n(r)}),r.addEventListener("error",function(){t(new Error(`JS resource ${e} load failed`))}),document.head.appendChild(r)}).finally(function(){document.head.removeChild(r)})}),r.set("css",function(e){return new Promise(function(r,n){const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.dataset.flag="resource-preloader",t.addEventListener("load",function(){r(t)}),t.addEventListener("error",function(){n(new Error(`CSS resource ${e} load failed`)),document.head.removeChild(t)}),document.head.appendChild(t)})}),r.set("img",function(e){const r=new Image;return r.dataset.flag="resource-preloader",new Promise(function(n,t){r.addEventListener("load",function(){n(r)}),r.addEventListener("error",function(){t(new Error(`IMG resource ${e} load failed`))}),r.src=e})}),r.set("json",function(e){return fetch(e).then(function(r){if(!r.ok)throw new Error(`JSON resource ${e} load failed`);return r.json()}).catch(function(r){throw new Error(`JSON resource ${e} load failed: ${r.message}`)})}),o.registerLoader=function(e,n){if("string"!=typeof e||""===e.trim())throw new Error("资源类型必须是非空字符串");const t=Object.prototype.toString.call(e).slice(8,-1);if(["Function","AsyncFunction"].includes(t))throw new Error("加载器必须是一个函数返回Promise对象或一个异步函数");r.has(e)&&console.warn(`类型为${e}的加载器已存在，将被覆盖`),r.set(e,n)},o.setGlobalConfig=function(r){if("object"!=typeof r||null===r)throw new Error("配置参数必须是一个非空对象");return e={...e,...r},{...e}},module.exports=o;


},{}],2:[function(require,module,exports){
const loader = require('../dist/resource-preloader.cjs.min.js');

each('CJS', loader);


},{"../dist/resource-preloader.cjs.min.js":1}]},{},[2]);
